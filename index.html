<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boss Spawn Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 3rem;
      font-size: 2.5rem;
    }

    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .card h3 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      color: #58a6ff;
      border-left: 3px solid #58a6ff;
      padding-left: 1rem;
      font-size: 1.5rem;
    }

    .card p {
      color: #8b949e;
      margin-bottom: 1rem;
    }

    .server-time {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
      background: #21262d;
      padding: 1rem;
      border-radius: 8px;
    }

    .server-time span {
      font-size: 1.2rem;
      font-family: monospace;
      color: #58a6ff;
      font-weight: bold;
    }

    .day-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .day-btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: 1px solid #30363d;
      background: #21262d;
      color: #c9d1d9;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.95rem;
    }

    .day-btn:hover {
      background: #30363d;
    }

    .day-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #21262d;
      border-radius: 8px;
      overflow: hidden;
    }

    thead {
      background: #30363d;
    }

    th {
      padding: 0.75rem;
      text-align: center;
      font-size: 0.8rem;
      color: #58a6ff;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid #30363d;
    }

    th:first-child {
      text-align: left;
    }

    td {
      padding: 1rem 0.75rem;
      white-space: nowrap;
      text-align: center;
      border-bottom: 1px solid #30363d;
      color: #8b949e;
    }

    td:first-child {
      text-align: left;
    }

    tbody tr:hover {
      background: rgba(48, 54, 61, 0.5);
    }

    .boss-name {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .countdown {
      font-family: monospace;
      font-size: 1.1rem;
      font-weight: bold;
    }

    .notification-settings {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .notification-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      color: #c9d1d9;
    }

    .notification-option input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #58a6ff;
      cursor: pointer;
    }

    .notification-inline {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .notification-inline label {
      color: #8b949e;
      white-space: nowrap;
    }

    .notification-inline select {
      flex: 1;
      min-width: 150px;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: #c9d1d9;
      outline: none;
      cursor: pointer;
    }

    .btn-test {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      font-size: 0.95rem;
    }

    .btn-test:hover {
      transform: translateY(-2px);
    }

    .note-box {
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 0.5rem;
    }

    .note-box p {
      margin: 0;
      color: #8b949e;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .note-box strong {
      color: #58a6ff;
    }

    .footer {
      text-align: center;
      margin-top: 3rem;
      color: #8b949e;
      font-size: 0.875rem;
      padding-bottom: 2rem;
    }

    .highlight {
      font-weight: bold;
    }

    .primeval { color: #3fb950; }
    .frostscale { color: #58a6ff; }
    .skypetal { color: #f59e0b; }
    .spawned { color: #f85149; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Boss Spawn Tracker</h1>

    <!-- Overview Card -->
    <div class="card">
      <h3>Overview</h3>
      <p>
        Track boss spawn times across all days of the week. This tracker monitors three boss types: 
        <span class="primeval highlight">Primeval</span>, 
        <span class="frostscale highlight">Frostscale</span>, and 
        <span class="skypetal highlight">Skypetal</span>.
      </p>
      <p>
        Server times are displayed in GMT-6. Your local timezone is <span class="frostscale highlight" id="userTimezone"></span>.
      </p>

      <div class="server-time">
        <span>‚è∞</span>
        <span id="serverClock">00:00:00</span>
      </div>
    </div>

    <!-- Day Filter Card -->
    <div class="card">
      <div class="day-filter" id="dayFilter">
        <button class="day-btn active" data-day="today">Today</button>
        <button class="day-btn" data-day="0">Sunday</button>
        <button class="day-btn" data-day="1">Monday</button>
        <button class="day-btn" data-day="2">Tuesday</button>
        <button class="day-btn" data-day="3">Wednesday</button>
        <button class="day-btn" data-day="4">Thursday</button>
        <button class="day-btn" data-day="5">Friday</button>
        <button class="day-btn" data-day="6">Saturday</button>
      </div>
    </div>

    <!-- Boss Schedule Card -->
    <div class="card">
      <h3>Boss Schedule</h3>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>üìç Boss Location</th>
              <th>Time Until Spawn</th>
              <th>Server Time</th>
              <th>Next Spawn (Your Time)</th>
            </tr>
          </thead>
          <tbody id="bossTable">
          </tbody>
        </table>
      </div>
    </div>

    <!-- Notification Settings Card -->
    <div class="card">
      <h3>‚öôÔ∏è Notification Settings</h3>
      <div class="notification-settings">
        <label class="notification-option">
          <input type="checkbox" id="enableNotifications">
          <span>üîî Enable Notifications</span>
        </label>

        <div class="notification-inline">
          <label>Alert me</label>
          <select id="notificationMinutes">
            <option value="5">5 minutes before</option>
            <option value="10">10 minutes before</option>
            <option value="15">15 minutes before</option>
            <option value="20">20 minutes before</option>
            <option value="30">30 minutes before</option>
          </select>
          <button class="btn-test" id="testNotification">Test Notification</button>
        </div>

        <label class="notification-option">
          <input type="checkbox" id="soundEnabled">
          <span>Play Sound with Notification</span>
        </label>

        <div class="note-box">
          <p>
            <strong>Note:</strong> Browser notifications must be enabled for this feature to work. Click "Test Notification" to verify your settings. Notifications will alert you before each boss spawn based on your selected time interval.
          </p>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>Boss Spawn Tracker | Real-time countdown and notifications</p>
    </div>
  </div>

  <script>
    // Boss data
    const bossData = {
      1: [ // Monday
        { time: '0:00', boss: 'Primeval', color: 'primeval' },
        { time: '1:22', boss: 'Primeval', color: 'primeval' },
        { time: '2:37', boss: 'Skypetal', color: 'skypetal' },
        { time: '3:55', boss: 'Skypetal', color: 'skypetal' },
        { time: '4:30', boss: 'Primeval', color: 'primeval' },
        { time: '5:57', boss: 'Frostscale', color: 'frostscale' },
        { time: '6:30', boss: 'Primeval', color: 'primeval' },
        { time: '7:49', boss: 'Skypetal', color: 'skypetal' },
        { time: '9:13', boss: 'Primeval', color: 'primeval' },
        { time: '10:56', boss: 'Skypetal', color: 'skypetal' },
        { time: '12:09', boss: 'Primeval', color: 'primeval' },
        { time: '13:43', boss: 'Primeval', color: 'primeval' },
        { time: '14:38', boss: 'Frostscale', color: 'frostscale' },
        { time: '15:26', boss: 'Skypetal', color: 'skypetal' },
        { time: '16:34', boss: 'Frostscale', color: 'frostscale' },
        { time: '17:09', boss: 'Primeval', color: 'primeval' },
        { time: '18:39', boss: 'Primeval', color: 'primeval' },
        { time: '20:08', boss: 'Skypetal', color: 'skypetal' },
        { time: '20:31', boss: 'Primeval', color: 'primeval' },
        { time: '21:49', boss: 'Skypetal', color: 'skypetal' },
        { time: '21:49', boss: 'Frostscale', color: 'frostscale' },
        { time: '23:05', boss: 'Primeval', color: 'primeval' },
        { time: '23:09', boss: 'Frostscale', color: 'frostscale' }
      ],
      2: [ // Tuesday
        { time: '0:00', boss: 'Frostscale', color: 'frostscale' },
        { time: '1:16', boss: 'Primeval', color: 'primeval' },
        { time: '2:39', boss: 'Frostscale', color: 'frostscale' },
        { time: '3:02', boss: 'Skypetal', color: 'skypetal' },
        { time: '4:18', boss: 'Primeval', color: 'primeval' },
        { time: '5:57', boss: 'Skypetal', color: 'skypetal' },
        { time: '6:48', boss: 'Frostscale', color: 'frostscale' },
        { time: '7:22', boss: 'Primeval', color: 'primeval' },
        { time: '8:42', boss: 'Skypetal', color: 'skypetal' },
        { time: '10:16', boss: 'Primeval', color: 'primeval' },
        { time: '11:42', boss: 'Frostscale', color: 'frostscale' },
        { time: '13:20', boss: 'Skypetal', color: 'skypetal' },
        { time: '14:38', boss: 'Frostscale', color: 'frostscale' },
        { time: '15:56', boss: 'Skypetal', color: 'skypetal' },
        { time: '16:34', boss: 'Frostscale', color: 'frostscale' },
        { time: '17:34', boss: 'Primeval', color: 'primeval' },
        { time: '19:05', boss: 'Primeval', color: 'primeval' },
        { time: '20:51', boss: 'Skypetal', color: 'skypetal' },
        { time: '21:49', boss: 'Skypetal', color: 'skypetal' },
        { time: '23:09', boss: 'Frostscale', color: 'frostscale' }
      ],
      3: [ // Wednesday
        { time: '0:00', boss: 'Frostscale', color: 'frostscale' },
        { time: '1:36', boss: 'Primeval', color: 'primeval' },
        { time: '3:02', boss: 'Frostscale', color: 'frostscale' },
        { time: '4:30', boss: 'Skypetal', color: 'skypetal' },
        { time: '5:57', boss: 'Frostscale', color: 'frostscale' },
        { time: '6:08', boss: 'Skypetal', color: 'skypetal' },
        { time: '7:48', boss: 'Primeval', color: 'primeval' },
        { time: '9:26', boss: 'Skypetal', color: 'skypetal' },
        { time: '10:44', boss: 'Primeval', color: 'primeval' },
        { time: '12:11', boss: 'Skypetal', color: 'skypetal' },
        { time: '13:29', boss: 'Frostscale', color: 'frostscale' },
        { time: '14:57', boss: 'Skypetal', color: 'skypetal' },
        { time: '15:57', boss: 'Frostscale', color: 'frostscale' },
        { time: '16:40', boss: 'Primeval', color: 'primeval' },
        { time: '18:03', boss: 'Frostscale', color: 'frostscale' },
        { time: '19:42', boss: 'Skypetal', color: 'skypetal' },
        { time: '20:31', boss: 'Frostscale', color: 'frostscale' },
        { time: '21:22', boss: 'Skypetal', color: 'skypetal' },
        { time: '22:37', boss: 'Primeval', color: 'primeval' }
      ],
      4: [ // Thursday
        { time: '0:08', boss: 'Frostscale', color: 'frostscale' },
        { time: '1:25', boss: 'Primeval', color: 'primeval' },
        { time: '2:44', boss: 'Frostscale', color: 'frostscale' },
        { time: '3:08', boss: 'Skypetal', color: 'skypetal' },
        { time: '4:26', boss: 'Frostscale', color: 'frostscale' },
        { time: '5:53', boss: 'Skypetal', color: 'skypetal' },
        { time: '7:17', boss: 'Primeval', color: 'primeval' },
        { time: '8:52', boss: 'Skypetal', color: 'skypetal' },
        { time: '10:07', boss: 'Skypetal', color: 'skypetal' },
        { time: '11:44', boss: 'Frostscale', color: 'frostscale' },
        { time: '13:14', boss: 'Primeval', color: 'primeval' },
        { time: '14:57', boss: 'Primeval', color: 'primeval' },
        { time: '16:22', boss: 'Skypetal', color: 'skypetal' },
        { time: '16:53', boss: 'Frostscale', color: 'frostscale' },
        { time: '17:53', boss: 'Primeval', color: 'primeval' },
        { time: '19:19', boss: 'Skypetal', color: 'skypetal' },
        { time: '20:40', boss: 'Frostscale', color: 'frostscale' },
        { time: '21:56', boss: 'Primeval', color: 'primeval' },
        { time: '23:25', boss: 'Primeval', color: 'primeval' }
      ],
      5: [ // Friday
        { time: '0:00', boss: 'Skypetal', color: 'skypetal' },
        { time: '1:44', boss: 'Primeval', color: 'primeval' },
        { time: '3:06', boss: 'Skypetal', color: 'skypetal' },
        { time: '4:38', boss: 'Frostscale', color: 'frostscale' },
        { time: '6:10', boss: 'Primeval', color: 'primeval' },
        { time: '7:52', boss: 'Primeval', color: 'primeval' },
        { time: '9:23', boss: 'Skypetal', color: 'skypetal' },
        { time: '10:42', boss: 'Skypetal', color: 'skypetal' },
        { time: '12:09', boss: 'Skypetal', color: 'skypetal' },
        { time: '13:36', boss: 'Frostscale', color: 'frostscale' },
        { time: '14:57', boss: 'Primeval', color: 'primeval' },
        { time: '16:23', boss: 'Skypetal', color: 'skypetal' },
        { time: '17:57', boss: 'Primeval', color: 'primeval' },
        { time: '19:57', boss: 'Frostscale', color: 'frostscale' },
        { time: '20:59', boss: 'Primeval', color: 'primeval' },
        { time: '22:19', boss: 'Frostscale', color: 'frostscale' },
        { time: '23:50', boss: 'Primeval', color: 'primeval' },
        { time: '23:50', boss: 'Skypetal', color: 'skypetal' }
      ],
      6: [ // Saturday
        { time: '0:52', boss: 'Frostscale', color: 'frostscale' },
        { time: '2:30', boss: 'Primeval', color: 'primeval' },
        { time: '3:52', boss: 'Frostscale', color: 'frostscale' },
        { time: '5:28', boss: 'Skypetal', color: 'skypetal' },
        { time: '6:51', boss: 'Frostscale', color: 'frostscale' },
        { time: '8:11', boss: 'Primeval', color: 'primeval' },
        { time: '9:56', boss: 'Skypetal', color: 'skypetal' },
        { time: '11:36', boss: 'Frostscale', color: 'frostscale' },
        { time: '12:54', boss: 'Skypetal', color: 'skypetal' },
        { time: '14:24', boss: 'Primeval', color: 'primeval' },
        { time: '16:01', boss: 'Frostscale', color: 'frostscale' },
        { time: '17:25', boss: 'Skypetal', color: 'skypetal' },
        { time: '19:01', boss: 'Frostscale', color: 'frostscale' },
        { time: '20:46', boss: 'Primeval', color: 'primeval' },
        { time: '22:27', boss: 'Skypetal', color: 'skypetal' },
        { time: '23:57', boss: 'Primeval', color: 'primeval' }
      ],
      0: [ // Sunday
        { time: '1:15', boss: 'Primeval', color: 'primeval' },
        { time: '2:30', boss: 'Primeval', color: 'primeval' },
        { time: '4:06', boss: 'Skypetal', color: 'skypetal' },
        { time: '5:34', boss: 'Frostscale', color: 'frostscale' },
        { time: '7:06', boss: 'Skypetal', color: 'skypetal' },
        { time: '8:47', boss: 'Skypetal', color: 'skypetal' },
        { time: '10:23', boss: 'Primeval', color: 'primeval' },
        { time: '11:55', boss: 'Frostscale', color: 'frostscale' },
        { time: '13:18', boss: 'Primeval', color: 'primeval' },
        { time: '14:37', boss: 'Frostscale', color: 'frostscale' },
        { time: '16:00', boss: 'Skypetal', color: 'skypetal' },
        { time: '17:44', boss: 'Primeval', color: 'primeval' },
        { time: '19:10', boss: 'Frostscale', color: 'frostscale' },
        { time: '20:44', boss: 'Primeval', color: 'primeval' },
        { time: '21:56', boss: 'Frostscale', color: 'frostscale' },
        { time: '22:23', boss: 'Skypetal', color: 'skypetal' }
      ]
    };

    const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    let selectedDay = 'today';
    let notifiedBosses = {};

    // Get GMT-6 time
    function getServerTime() {
      const now = new Date();
      const utc = new Date(now.toLocaleString("en-US", { timeZone: "UTC" }));
      const gmt6 = new Date(utc.getTime() - (6 * 60 * 60 * 1000));
      return gmt6;
    }

    function getUserTimezone() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone;
    }

    function parseTime(timeStr, dayOffset = 0) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      const serverNow = getServerTime();
      const date = new Date(serverNow);
      date.setHours(hours, minutes, 0, 0);
      date.setDate(date.getDate() + dayOffset);
      return date;
    }

    function getTimeUntilSpawn(spawnTime, dayIndex) {
      const serverNow = getServerTime();
      const currentDay = serverNow.getDay();
      let dayDiff = dayIndex - currentDay;
      if (dayDiff < 0) dayDiff += 7;
      
      const spawn = parseTime(spawnTime, dayDiff);
      const diff = spawn - serverNow;
      
      if (diff < 0 && dayDiff === 0) {
        return parseTime(spawnTime, 7) - serverNow;
      }
      
      return diff;
    }

    function formatCountdown(ms) {
      if (ms <= 0) return 'Spawned';
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function renderBosses() {
      const serverNow = getServerTime();
      const currentDay = serverNow.getDay();
      const dayToShow = selectedDay === 'today' ? currentDay : parseInt(selectedDay);
      
      const bosses = bossData[dayToShow].map(boss => {
        const timeUntil = getTimeUntilSpawn(boss.time, dayToShow);
        const localSpawnTime = new Date(Date.now() + timeUntil);
        
        return {
          ...boss,
          dayIndex: dayToShow,
          timeUntil: timeUntil,
          countdown: formatCountdown(timeUntil),
          localSpawnTime: localSpawnTime
        };
      });

      // Filter for "Today" tab only
      let filtered = bosses;
      if (selectedDay === 'today') {
        filtered = bosses.filter(boss => boss.timeUntil <= 24 * 60 * 60 * 1000);
      }
      
      filtered.sort((a, b) => a.timeUntil - b.timeUntil);

      const tbody = document.getElementById('bossTable');
      tbody.innerHTML = '';

      filtered.forEach(boss => {
        const tr = document.createElement('tr');
        
        const countdownClass = boss.timeUntil <= 0 ? 'spawned' : boss.color;
        
        tr.innerHTML = `
          <td><span class="boss-name ${boss.color}">${boss.boss}</span></td>
          <td><span class="countdown ${countdownClass}">${boss.countdown}</span></td>
          <td>${boss.time}</td>
          <td>${boss.localSpawnTime.toLocaleString('en-US', { 
            weekday: 'short',
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
          })}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }

    function updateClock() {
      const serverTime = getServerTime();
      document.getElementById('serverClock').textContent = 
        'Server Time: ' + serverTime.toLocaleTimeString('en-US', { hour12: false });
    }

    function checkNotifications() {
      const enabled = document.getElementById('enableNotifications').checked;
      if (!enabled) return;

      const minutes = parseInt(document.getElementById('notificationMinutes').value);
      
      Object.keys(bossData).forEach(dayKey => {
        bossData[dayKey].forEach(boss => {
          const msUntil = getTimeUntilSpawn(boss.time, parseInt(dayKey));
          const minutesUntil = Math.floor(msUntil / 60000);
          
          const notifKey = `${boss.boss}_${boss.time}_${minutesUntil}`;
          
          if (minutesUntil === minutes && !notifiedBosses[notifKey]) {
            notifiedBosses[notifKey] = true;
            showNotification(boss.boss, boss.time, minutes);
          }
        });
      });
    }

    function showNotification(bossName, time, minutes) {
      if (!('Notification' in window)) return;

      if (Notification.permission === 'granted') {
        new Notification('Boss Spawn Alert', {
          body: `${bossName} will spawn in ${minutes} minutes at ${time}!`,
          icon: 'üéÆ'
        });
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission();
      }
    }

    function testNotification() {
      if (!('Notification' in window)) {
        alert('Your browser does not support notifications');
        return;
      }

      if (Notification.permission === 'granted') {
        new Notification('Boss Tracker Test', {
          body: 'Notifications are working correctly!',
          icon: 'üéÆ'
        });
      } else {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            testNotification();
          }
        });
      }
    }

    // Event listeners
    document.getElementById('dayFilter').addEventListener('click', (e) => {
      if (e.target.classList.contains('day-btn')) {
        document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        selectedDay = e.target.dataset.day;
        renderBosses();
      }
    });

    document.getElementById('testNotification').addEventListener('click', testNotification);

    // Initialize
    document.getElementById('userTimezone').textContent = getUserTimezone();
    renderBosses();
    updateClock();

    // Update every second
    setInterval(() => {
      renderBosses();
      updateClock();
      checkNotifications();
    }, 1000);
  </script>
</body>
</html>
